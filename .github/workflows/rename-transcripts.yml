name: Rename transcript files for Windows compatibility

on:
  workflow_dispatch:

jobs:
  rename:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Rename files to ISO 8601 basic format
        run: |
          cd video-transcripts/transcripts
          for f in *.md; do
            # Convert 2023-06-01T17:22:03Z to 20230601T172203Z
            newname=$(echo "$f" | sed 's/\([0-9]\{4\}\)-\([0-9]\{2\}\)-\([0-9]\{2\}\)T/\1\2\3T/; s/T\([0-9]\{2\}\):\([0-9]\{2\}\):\([0-9]\{2\}\)Z/T\1\2\3Z/')
            if [ "$f" != "$newname" ]; then
              echo "Renaming $f -> $newname"
              git mv "$f" "$newname"
            fi
          done

      - name: Commit and push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git commit -m "Rename transcript files to Windows-compatible ISO 8601 basic format"
          git push
